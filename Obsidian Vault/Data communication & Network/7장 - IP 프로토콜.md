### 네트워크 계층 Network Layer의 주요 기능
- 라우팅
- 혼잡 제어
	- 패킷 수가 과도하게 증가하는 현상을 예방하거나 제어하는 기능
- 패킷의 분할과 병합
	- 패킷 분할: 큰 패킷을 여러 작은 패킷으로 나누는 과정
	- 패킷 병합: 목적지에서 분할된 패킷을 다시 모으는 과정
---
### 연결형 서비스와 비연결형 서비스
- 둘 사이 차이
	- 패킷이 전달되는 경로 상 연결된 설정을 따라가느냐 여부
![[7장 - IP 프로토콜-20240405111918287.webp|500]]
### 비연결형 서비스
- 패킷의 **전달 순서**, 패킷 **분실 여부 등** **연결형 서비스보다 신뢰성이 떨어지는 전송 방식**
	- 오류 제어와 흐름 제어 기능을 더 많이 수행해야 함
	- 도착한 순서 번호가 일정하지 않음 -> L4 전송 계층에서 패킷 순서를 재조정해야하 함
	- **Ex.** IP프로토콜의 UDP
### 연결형 서비스
- 패킷을 **전송하기 전에 연결 설정을 미리하는 신뢰성이 높은 전송 방식**
	- 패킷이 연결 설정된 경로로 모두 동일하게 전송됨
	- 패킷의 순서 번호가 틀어지지 않음
	- **Ex.** IP프로토콜의 TCP
### 라우팅
- 입력 패킷에 대한 출력 경로를 설정하는 것
- **가상 회선 방식**
	- 연결 설정되는 시점에 한 번만 결정하고 이후 모든 패킷이 동일한 경로로 모두 전송됨.
- **데이터그램 방식**
	- 연결 설정 과정이 없기 때문에 독립적으로 전달 경로를 선택해줘야 함
- 패킷 전송 경로 설정시 **고려할 사항**
	- 모든 전송 패킷에 대해 라우팅 과정이 공평해야 함
	- 효율성 측면에서 패킷의 평균 지연시간, 전체 네트워크의 성능, 라우터 수의 최소화 등
### 정적 · 동적 라우팅
- **정적 라우팅**
	- 송수신 호스트 사이에 패킷 전송이 이루어지기 전에 경로 정보를 라우터에 미리 저장하여 중개하는 방식
	- 운용 중에 네트워크 변화가 생기면 적절하게 대응하기가 어려움
	- 실시간으로 네트워크 내부의 혼잡도를 반영하기 어려움
- **동적 라우팅**
	- 라우터의 경로 정보를 네트워크 상황에 따라 적절하게 변경하는 방식
	- 현재의 네트워크 상황을 고려해 최적 경로를 제공함
	- 경로 정보 수집/관리가 복잡하고 라우팅 정보 관리가 네트워크에 또 다른 부하를 줌
	- 이웃 라우터의 존재 유무와 전송 시간 확인 필요, 라우터의 획득한 경로 정보를 이웃 라우터와 공유/갱신
### HELLO/ECHO 패킷
- **HELLO 패킷**
	- 라우터의 초기화 과정에서 이웃 라우터의 경로 정보를 파악하는 것
- **ECHO 패킷**
	- 라우터 사이의 전송 시간을 측정하는 것
	- 이런 과정을 반복하고 측정값의 평균을 구해 이웃 라우터까지의 전송 지연 시간을 유추함
	- 측정 시점의 네트워크 트래픽 정도에 따라 전송 지연 시간의 충정 오차가 발생할 수 있음
- 임의의 라우터가 획득한 정보를 다른 라우터와 경로 정보 공유 시, 개별 라우터의 갱신 시간이 일치하지 않아 네트워크 상태에 따른 내부 경로 정보를 일관성 있게 유지하기가 여러움
### 라우팅 테이블
- 라우터들의 적절한 경로 정보가 저장된 곳
	- 다음 홉 Hop 에 위치한 라우터의 주소를 기록함
	- 라우터 1 -> 호스트 11일 경우 다음 홉은 ? ------> **4**
![[7장 - IP 프로토콜-20240405112741220.webp|500]]
- 라우터 4에서 동일한 과정 반복
- 최종 호스트 11까지 경로 결정
---
### 라우팅 정보의 처리
- 네트워크의 현재 상황을 반영할 수 있도록 관리
	- **소스 라우팅**: 패킷 스스로가 수신 호스트까지의 전달 경로 정보를 결정하여 저장하는 방식. 라우팅 테이블 관리가 필요 없음. 가상 회선/데이터그램 방식 모두 이용 가능
	- **분산 라우팅**: 라우팅 정보가 분산된 방식. 데이터그램 방식에서 많이 활용, 패킷의 전송 경로상의 라우터가 네트워크의 동적인 상황을 적절히 반영함
	- **중앙 라우팅**: RCC 라는 특별한 호스트가 전송 경로에 관한 모든 정보를 관리하는 방식, 네트워크 규모가 커지면 RCC의 부하가 가중됨. 소스 라우팅과 동일한 원리로 패킷 전송
	- **계층 라우팅**: 분산 라우팅 + 중앙 라우팅. 네트워크 규모가 커져도 효과적임
---
### 혼잡 제어
- 전송 패킷 수가 많아지면 네트워크의 성능이 악화되는 현상을 해결하기 위한 방안
	- 흐름 제어보다 더 넓은 관점에서 호스트와 라우터를 포함한 서브넷의 전송 능력 문제를 다룸
![[7장 - IP 프로토콜-20240405113154368.webp|400]]
- 혼잡이 발생하는 원인
	- 패킷 입력이 많아짐 -> 라우터의 버퍼에 쌓이는 패킷이 많아짐 -> 패킷 손실 발생 -> 타임아웃 기능을 통해 재전송하는 패킷 량이 많아짐 (악순환)
	- 패킷 전송 지연 시간 > 송신 호스트 타임아웃 -> 패킷을 재전송하는 패킷 량이 많아짐 (악순환)
- 혼잡 해결 방안
	- 일반적으로 **송신 호스트의 타임아웃 시간을 늘림**
	- 수신 패킷에 대한 개별 응답도 혼잡에 영향을 줌 -> 피기배깅 방식(완전한 대응 방식은 아님)
	- 혼잡이 적은 경로로 안내하는 라우팅 알고리즘
	- 패킷 생존 시간(TTL)을 통한 제어
- **트래픽 성형**
	- 네트워크로 유입되는 패킷의 분포를 미리 알아 두면 순간적으로 발생하는 과도한 트래픽에 대해 적절히 대응할 수 있음
	- 리키 버킷 알고리즘: 깔때기가 유입 트래픽 제어
![[7장 - IP 프로토콜-20240405113438366.webp|300]]
- **가상 회선을 이용한 혼잡 제어**
	- 특정 지역에 혼잡이 발생하면 패킷의 전송 경로를 조정함으로써 혼잡한 경로의 연결 설정을 허락하지 않음
- **자원 예약 방식을 이용한 혼잡 제어**
	- 호스트와 서브넷의 가상 회선 연결을 미리 할당 받음
	- 불필요한 통신 자원 낭비