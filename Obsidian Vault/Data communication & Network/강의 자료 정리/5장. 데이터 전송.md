### MAC과 LLC 계층
![[5장. 데이터 전송-20240418193008708.webp|400]]
### LAN 환경을 위한 MAC 계층
공유 버스 방식을 지원하는 CSMA/CD 방식
- 대표적으로 이더넷
- 데이터를 전송하기 전에 전송 선로를 먼저 확인한 후 데이터 전송 여부를 판단함
- 둘 이상의 프레임이 동시에 전송되면 충돌이 발생하고 일정 시점이 지난 후 재전송을 해야 함
링 구조를 지원하는 토큰 링 방식
- 토큰이라는 제어 프레임 1개만 링에 순환하기 때문에 충돌은 발생하지 않음
- 전송 프레임은 링 전체를 순환하는 구조이기 때문에 브로드캐스팅 방식을 지원함
### LAN 환경을 위한 LLC 계층
송수신 호시트 사이의 프레임 전송 과정에서 물리적인 오류가 발생하면 복구하는 작업을 수행
- 데이터 변형, 데이터 분실에 관한 오류 제어
- 송수신 호스트 사이의 속도 차이에 관한 흐름 제어
LAN 종류에 따라 LLC가 다를 수 있음
- CSMA/CD나 토큰 링에서 사용하는 LLC가 상이할 수 있음
- 슬라이딩 우니도우 프로토콜은 CSMA/CD 기반의 LLC 계층의 프레임을 전송할 때 사용하지만 토큰 링/토큰 버스 구조에서는 불필요
※ **슬라이딩 윈도우 프로토콜** : 윈도우 크기 내에 ACK가 수신하면 윈도우 크기 만큼 추가 패킷을 전송하는 방식
##### CSMA/CD
데이터 충돌 해결 방식 2가지
- 충돌을 허용하는 방식 : 이더넷의 CSMA/CD 방식, 충돌에 따른 오류 복구 과정의 재전송이 빈번하게 발생하여 네트워크 전체의 성능이 떨어질 수 있음
- 충돌을 회피하는 방식 : 토큰 버스 / 토큰 링 방식, 송신 호스트에서 서로 다른 전송 시간대(타임 슬롯<sup>Time Slot</sup>)를 배정하는 방법
---
공유 버스로 데이터 전송: 호스트 5 → 호스트 1
- 전송 프레임은 모든 호스트로 브로드캐스팅 됨
- 목적지 주소가 자신ㅁ의 주소와 일치하지 않으면 버림
- 데이터 전송 전 공유 버스가 사용 중인지 확인 필요
- 충돌 발생 인지/통지 기능 필요
- 충돌을 감지하면 전송을 중단하고 오류 복구 절차 수행
![[5장. 데이터 전송-20240418193606517.webp|350]]
---
### 토큰 버스
전송 권한이 같은 토큰을 확보해야 함
- 토큰을 획득한 뒤 전송 기회를 부여 받음
- 데이터 전송을 완료하면 논리적인 순서에 따라 이웃 호스트로 토큰일 이양
![[5장. 데이터 전송-20240418193703390.webp|400]]
---
### 토큰 링
대기 모드(호스트 중개하지 않음)
- 입력단으로 들어온 비트를 출력단으로 **즉시** 내보냄
- 인터페이스가 링 네트워크를 유지하는 역할을 수행함
- 호스트가 다운되더라도 네트웤느 동작에 영향을 주지 않음
전송 모드(호스트 중개함 - 전송 권한 획득 상태)
- 입력단과 출력단의 논리적 연결이 끊어짐
- 출력단을 통해 데이터를 전송할 수 있고 자신에게 되돌아온 프레임이 올바르게 전송되면 데이터 프레임을 회수하고 토큰을 링에 반환함
![[5장. 데이터 전송-20240418193840701.webp|300]]
---
### 신호 감지 기능
신호 감지 프로토콜
- 전송 매체의 신호를 감지해 프레임의 전송 여부를 결정하는 프로토콜
- 신호를 감지하여 공유 버스가 사용하고 있으면 정책에 따라 다시 신호 감지를 실시하고, 사용하고 있지 않으면 프레임 전송을 시작함
---
##### 신호 감지 기능
1-persistent CSMA
- 확률 1의 조건이라 믿고 채널이 유휴 상태까지 임의의 시간 동안 기다린 후 다시 전송하는 방식
- 둘 이상의 호스트에서 동시에 전송 채널을 유휴로 판단하면 충돌이 발생할 수 있음
Non-persistent CSMA
- 충돌이 될 거라 생각하고 무조건 임의의 시간 동안 기다린 후 다시 전송하는 방식
- 충돌이 발생할 확률은 적으나 전송을 위해 대기 시간이 길어짐
**p-persistent CSMA**
- 채널이 유휴 상태이면 p 의 확률로 프레임을 전송하고 채널이 사용 중이면 단위 시간 만큼 기다린 후 전송함
---
CSMA/CD<sup>Collision Detection</sup> (충돌 감지)
- CSMA보다 개선된 방식, 유선 LAN에서 사용, ACK 프레임 미사용
- 전송 과정에서 충돌을 감지하면 프레임의 전송을 중지
- 재전송하기 전에 랜덤 시간 (충돌이 발생하면 기다리는 시간<sup>Back off time</sup>이 2배로 증가) 만큼 기다림
- 재전송하기 위한 16회까지 시도하고 포기
CSMA/CA<sup>Collision Avoidance</sup>
- 전송 매체가 Air라서 전송 전에 캐리어 감지를 해보고 일정시간을 기다린 후 가능한 충돌을 회피하는 방식
- 무선 LAN에서 사용, ACK 프레임 사용
- 충돌이 발생하면 기다리는 시간<sup>Back off time</sup>이 2배로 증가하지만 최대 1023 time slot (단위 시간)까지 허용됨
---
##### 고전적 충돌 감지 방법
이더넷 트랜시버가 충돌 감지 기능을 제공함
- 현재는 이더넷 표준에서 이더넷 트랜시버 없이 가능
이더넷 트랜시버의 불편한 점
- 충돌을 감지하더라도 특정 신호로 재변환 후 전송 케이블을 이용하여 재전송해야함
- 전송 케이블이 길면 신호 감쇠 때문에 리피터를 추가해야 함
![[5장. 데이터 전송-20240418194255431.webp|300]]
---
### 이더넷 프레임 구조
CSMA/CD MAC 프레임
- 헤더 + 데이터 + 트레일러(tail) 로 구성
- 이더넷 프레임이라고도 함 (단위: 바이트)
![[5장. 데이터 전송-20240418194331783.webp|500]]
- Preamble: 송수신 호스트의 클럭 동기를 맞출 수 있도록 시간 여유를 제공함 (101010**10** 비트 패턴을 포함)
- Start Delimiter: 프레임이 시작된다는 의미 (101010**11** 비트 패턴을 포함)
- Source/Destination Address: LAN 카드에 내장된 고유의 MAC 주소를 사용, 수신 호스트 주소의 최상위 비트가 1/0이면 그룹 주소/일반 주소를 의미하고 수신 호스트 주소의 모든 비트가 1이면 브로드캐스팅임
- Length/Type: 값이 1,500 (최대 패킷 크기: 초과하면 MAC 프레임이 분할되어 전송, 최소 46 이하이면 0으로 padding함) 이하이면 Length 의미로 해석, 이상이면 Type (상위 프로토콜의 패킷 종류)으로 해석됨
- Checksum: 데이터 **변형** 오류의 발생 여부를 수신 호스트가 확인하도록 송신 호스트가 값을 기록함, 이때Preamble, Start Delimiter, Checksum을 제외한 나머지 필드에 대한 오류를 검출함
---
### LLC 프레임 캡슐화
CSMA/CD MAC 프레임 내부에 LLC 프레임이 포함되어 있음
- L1에서는 헤더 정보 없이 전송됨
![[5장. 데이터 전송-20240418194504652.webp|600]]
---
### 허브와 스위치
이더넷에서 공유 버스, 일반 허브, 스위치 허브의 차이점
- (버스) 최근 100Mbps, 1Gbps 이더넷을 주로 사용하고 전송 프레임이 브로드캐스팅됨
![[5장. 데이터 전송-20240418194658876.webp|500]]
- (허브) 외형상 스타형 구조 (내부: 버스형 구조), 공유 버스 방식이므로 동시에 전송 시 충돌이 발생함
![[5장. 데이터 전송-20240418194627774.webp|500]]
- (스위치) 임의의 호스트로부터 수신한 프레임을 해당 지정 호스트로만 전송함, 스위치 내 호스트끼리 프레임 전송도 가능함, 전체 용량 증가의 효과
- 허브를 스위치로 교체해도 호스트에 영향이 없음
![[5장. 데이터 전송-20240418194741939.webp|502]]
---
### 토큰 버스
##### IEEE 802.4 토큰 버스
기존 이더넷 프레임의 문제점을 해소할 수 있음
- 특정 호스트가 오랫동안 프레임 전송을 못할 우려가 있음
- 프레임의 우선순위가 없어서 프레임의 중요도를 표현하기 어려움
공유 버스 구조에서 토큰 프레임을 이용하여 프레임의 전송 권한을 부여할 수 있음
---
토큰 버스 프레임 구조
 - 헤더 + 데이터 + 트레일러(tail) 로 구성
 - MAC 프레임에 해당함 (단위: 바이트)
![[5장. 데이터 전송-20240418194908143.webp|400]]
- Preamble: 송수신 호스트의 클럭 동기를 맞출 수 있도록 시간 여유를 제공함 (101010**10** 비트 패턴을 포함)
- Start/End Delimiter: 프레임이 시작/종료된다는 의미, 이 Delimiter 필드를 통해 프레임 크기를 결정함
- Source/Destination Address: LAN 카드에 내장된 고유의 MAC 주소를 사용, 수신 호스트 주소의 최상위 비트가 1/0이면 그룹 주소/일반 주소를 의미하고 수신 호스트 주소의 모든 비트가 1이면 브로드캐스팅임
- Checksum: 데이터 변형 오류의 발생 여부를 수신 호스트가 확인하도록 송신 호스트가 값을 기록함, 이때 Preamble, Start/End Delimiter, Checksum을 제외한 나머지 필드에 대한 오류를 검출함
---
##### 토큰 버스 MAC 프레임
![[5장. 데이터 전송-20240418195010942.webp]]

---
### LLC 프레임 캡슐화
토큰 버스 MAC 프레임 내부에 LLC 프레임이 포함되어 있음
- L1에서는 헤더 정보 없이 전송
![[5장. 데이터 전송-20240418195055335.webp|448]]
---
### 토큰 링 프레임 구조
- 헤더 + 데이터 + 트레일러(tail) 로 구성
- MAC 프레임에 해당함 (단위: 바이트)
![[5장. 데이터 전송-20240418195128080.webp|464]]
### 토큰 링 MAC 프레임
- Start/End Delimiter: 프레임이 시작/종료된다는 의미, 이 End Delimiter 필드를 통해 용도를 구분함 (I 비트: 여러 개로 나누어 전송, 1 비트: 여러 개 프레임 중 중간 프레임을 의미, 0 비트: 여러 개 비트 중 마지막 프레임을 의미, E 비트: 오류 검출용)
- ACAccess Control: 우선순위 (토큰보다 높은 우선 순위를 정함 – 000~111), 토큰 비트 (0/1 – 토큰/일반 프레임), 모니터 비트 (데이터 프레임의 M 비트를 1을 확인후 링에서 제거함으로 무한정 순환을 막음) 
![[5장. 데이터 전송-20240418195209617.webp|300]]
- FCFrame Control: TT 비트 값 (00: 제어 기능을 수행하기 위한 프레임, 01: 상위 LLC 계층에서 내려온 전송 데이터)에 의해 용도 구분함
![[5장. 데이터 전송-20240418195231490.webp|273]]
- FS<sup>Frame Status</sup>: 플래그 비트 (A/C) 한 쌍의 값이 동일한 경우에만 유효한 응답임 (다르면 무시됨), A비트 (1: 수신 호스트에서 데이터 프레임이 다시 자기에게 전달된 경우 – 정상 접근Access으로 판단/수신 주소가 다르면그냥 패스), C비트 (1: 수신 호스트로 전달된 프레임이 있으면 내부 버퍼에 보관 (Copy)하고 1로 지정)
- 11001100 // 수신 호스트가 데이터 프레임을 정상적으로 접근했고, 내부 버퍼에 정상적으로 보관 (Copy)함
![[5장. 데이터 전송-20240418195311202.webp|235]]
- Source/Destination Address: LAN 카드에 내장된 고유의 MAC 주소를 사용, 수신 호스트 주소의 최상위 비트가 1/0이면 그룹 주소/일반 주소를 의미하고 수신 호스트 주소의 모든 비트가 1이면 브로드캐스팅임
- Checksum: 데이터 변형 오류의 발생 여부를 수신 호스트가 확인하도록 송신 호스트가 값을 기록함, 이때, Start/End Delimiter, Checksum을 제외한 나머지 필드에 대한 오류를 검출함
---
### 토큰링 관리 호스트
모니터 호스트: 링 네트워크의 예기치 않은 오류를 복구하거나 데이터 프레임이 한 번 순환에 끝난 후 링에서 제거되어야 하는데 무한정 순환하는 오류를 찾아 제거해햐 함

---
##### LLC 프레임 캡슐화
토큰 링 MAC 프레임 내부에 LLC 프레임이 포함되어 있음
- L1에서는 헤더 정보 없이 전송
![[5장. 데이터 전송-20240418195423881.webp|506]]